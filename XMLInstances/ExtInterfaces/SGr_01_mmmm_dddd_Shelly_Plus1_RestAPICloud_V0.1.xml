<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<DeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/Product/Product.xsd">
  <deviceName>Shelly Plus 1 Cloud</deviceName>
  <manufacturerName>Shelly</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
    <changeLog>
      <version>0.1.0</version>
      <date>2024-10-16</date>
      <author>Matthias Krebs, FHNW</author>
      <comment>Draft for Testlab</comment>
    </changeLog>
  </releaseNotes>
  <deviceInformation>
    <legibleDescription>
      <textElement>
        <![CDATA[ 
          Der Shelly Plus 1 ist ein 1-kanaliges Relais.
          Die vorliegende EID ist auf die Ansteuerung via Cloud JSON-RPC API (Gen2) ausgelegt.
        ]]>
      </textElement>
      <language>de</language>
      <uri>https://www.shelly.com/de-ch/products/product-overview/shelly-plus-1</uri>
    </legibleDescription>
    <deviceCategory>SubMeterElectricity</deviceCategory>
    <isLocalControl>false</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <hardwareRevision>1.0.0</hardwareRevision>
    <manufacturerSpecificationIdentification>Shelly</manufacturerSpecificationIdentification>
    <levelOfOperation>1m</levelOfOperation>
    <versionNumber>
      <primaryVersionNumber>0</primaryVersionNumber>
      <secondaryVersionNumber>1</secondaryVersionNumber>
      <subReleaseVersionNumber>0</subReleaseVersionNumber>
    </versionNumber>
    <testState>None</testState>
  </deviceInformation>
  <configurationList>
    <configurationListElement>
      <name>base_uri</name>
      <dataType>
        <string />
      </dataType>
      <defaultValue>https://shelly-01-eu.shelly.cloud</defaultValue>
      <configurationDescription>
        <textElement>Base address for accessing the resource.</textElement>
        <language>en</language>
        <label>Base URI</label>
      </configurationDescription>
      <configurationDescription>
        <textElement>Basis-Adresse für Zugriffe auf die Ressource.</textElement>
        <language>de</language>
        <label>Basis URI</label>
      </configurationDescription>
    </configurationListElement>
    <configurationListElement>
      <name>device_id</name>
      <dataType>
        <string />
      </dataType>
      <defaultValue>ShellyPlus1</defaultValue>
      <configurationDescription>
        <textElement>ID of the cloud device.</textElement>
        <language>en</language>
        <label>Device ID</label>
      </configurationDescription>
      <configurationDescription>
        <textElement>ID des Cloud-Geräts.</textElement>
        <language>de</language>
        <label>Geräte ID</label>
      </configurationDescription>
    </configurationListElement>
    <configurationListElement>
      <name>auth_key</name>
      <dataType>
        <string />
      </dataType>
      <defaultValue></defaultValue>
      <configurationDescription>
        <textElement>Cloud authentication key.</textElement>
        <language>en</language>
        <label>Authentication Key</label>
      </configurationDescription>
      <configurationDescription>
        <textElement>Cloud-Authentifizierungs-Key.</textElement>
        <language>de</language>
        <label>Authentication Key</label>
      </configurationDescription>
    </configurationListElement>
  </configurationList>
  <interfaceList>
    <restApiInterface>
      <restApiInterfaceDescription>
        <restApiInterfaceSelection>URI</restApiInterfaceSelection>
        <restApiUri>{{base_uri}}</restApiUri>
        <restApiAuthenticationMethod>NoSecurityScheme</restApiAuthenticationMethod>
      </restApiInterfaceDescription>
      <functionalProfileList>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>DeviceStatus</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>DeviceInformation</functionalProfileCategory>
              <functionalProfileType>DeviceStatus</functionalProfileType>
              <levelOfOperation>m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>0</primaryVersionNumber>
                <secondaryVersionNumber>1</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
            <legibleDescription>
              <textElement>
                Ermöglicht das Auslesen des Gerätestatus.
              </textElement>
              <language>de</language>
            </legibleDescription>
            <legibleDescription>
              <textElement>
                Allows reading the device status.
              </textElement>
              <language>en</language>
            </legibleDescription>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ConnectionStatus</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <boolean />
                </dataType>
                <unit>NONE</unit>
                <legibleDescription>
                  <textElement>Verbindung zur Cloud</textElement>
                  <language>de</language>
                </legibleDescription>
                <legibleDescription>
                  <textElement>Cloud Connection</textElement>
                  <language>en</language>
                </legibleDescription>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiReadServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/device/status</requestPath>
                  <requestForm>
                    <parameter>
                      <name>id</name>
                      <value>{{device_id}}</value>
                    </parameter>
                    <parameter>
                      <name>auth_key</name>
                      <value>{{auth_key}}</value>
                    </parameter>
                  </requestForm>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>data.online</query>
                  </responseQuery>
                </restApiReadServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>Relais</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Actuator</functionalProfileCategory>
              <functionalProfileType>Relais</functionalProfileType>
              <levelOfOperation>1m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>0</primaryVersionNumber>
                <secondaryVersionNumber>1</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
            <legibleDescription>
              <textElement>Relais ein- oder ausschalten.</textElement>
              <language>de</language>
            </legibleDescription>
            <legibleDescription>
              <textElement>Switch relay on or off.</textElement>
              <language>en</language>
            </legibleDescription>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>Relais</dataPointName>
                <dataDirection>RW</dataDirection>
                <dataType>
                  <boolean />
                </dataType>
                <unit>NONE</unit>
                <legibleDescription>
                  <textElement>Relais-Status</textElement>
                  <language>de</language>
                </legibleDescription>
                <legibleDescription>
                  <textElement>Relay state</textElement>
                  <language>en</language>
                </legibleDescription>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_boolean</dataType>
                <restApiReadServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/device/status</requestPath>
                  <requestForm>
                    <parameter>
                      <name>id</name>
                      <value>{{device_id}}</value>
                    </parameter>
                    <parameter>
                      <name>auth_key</name>
                      <value>{{auth_key}}</value>
                    </parameter>
                  </requestForm>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>data.device_status."switch:0".output</query>
                  </responseQuery>
                </restApiReadServiceCall>
                <restApiWriteServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/device/relay/control</requestPath>
                  <requestForm>
                    <parameter>
                      <name>id</name>
                      <value>{{device_id}}</value>
                    </parameter>
                    <parameter>
                      <name>auth_key</name>
                      <value>{{auth_key}}</value>
                    </parameter>
                    <parameter>
                      <name>channel</name>
                      <value>0</value>
                    </parameter>
                    <parameter>
                      <name>turn</name>
                      <value>{{value}}</value>
                    </parameter>
                  </requestForm>
                  <valueMapping>
                    <mapping>
                      <genericValue>false</genericValue>
                      <deviceValue>off</deviceValue>
                    </mapping>
                    <mapping>
                      <genericValue>true</genericValue>
                      <deviceValue>on</deviceValue>
                    </mapping>
                  </valueMapping>
                </restApiWriteServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
      </functionalProfileList>
    </restApiInterface>
  </interfaceList>
</DeviceFrame>